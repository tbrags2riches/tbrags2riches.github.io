const NORMAL=1,FLIP=2,IPHONE_PORTRAIT_NORMAL=6,IPHONE_PORTRAIT_FLIP=5;var exifOrientation,$uploadCrop,tempFilename,rawImg,imageId,currentFaceNum,croppieOrientation=1;function readFile(e){if(e.files&&e.files[0]){var a=new FileReader;a.onload=function(a){$("#upload-demo").addClass("ready"),$("#cropImagePop").modal("show"),rawImg=a.target.result,e.value=null},a.readAsDataURL(e.files[0])}else swal("Sorry - either there was an error, or your browser doesn't support the FileReader API. Please try again.")}function croppieOrientFlipHorizontal(e){switch(e){case 1:e=2;break;case 2:e=1;break;case 3:e=4;break;case 4:e=3;break;case 5:e=6;break;case 6:e=5;break;case 7:e=8;break;case 8:e=7}return e}function croppieOrientRotateRight(e){switch(e){case 1:e=6;break;case 2:e=7;break;case 3:e=8;break;case 4:e=5;break;case 5:e=2;break;case 6:e=3;break;case 7:e=4;break;case 8:e=1}return e}function drawRotatedImage(e,a,t,o,i,r,n){var l=Math.PI/180;a.save(),a.translate(t+r/2,o+n/2),a.rotate(i*l),a.drawImage(e,-r/2,-n/2,r,n),a.restore()}function createInitialBillCanvas(){var e=document.getElementById("initialbillcanvas"),a=e.getContext("2d");a.clearRect(0,0,e.width,e.height);var t=new Image;t.onload=function(){a.drawImage(t,209,0),faceFilter(t,a,209,0);var o=new Image;o.onload=function(){var a=e.getContext("2d");a.globalCompositeOperation="overlay",a.drawImage(o,209,0),a.globalCompositeOperation="source-over";var t=new Image;t.onload=function(){e.getContext("2d").drawImage(t,0,0,945,402),createFinalBillCanvas()},t.src="assets/billcutout.png"},o.src="assets/noisefilter.jpg"},t.src=$("#faceimg").attr("src")}function faceFilter(e,a,t,o){for(var i=a.getImageData(t,o,e.width,e.height),r=i.data,n=0;n<r.length;n+=4){var l=.34*r[n]+.5*r[n+1]+.16*r[n+2];r[n]=l,r[n+1]=l,r[n+2]=l}a.putImageData(i,t,o),a.globalCompositeOperation="multiply",a.fillStyle="#ffffe1",a.fillRect(t,o,e.width,e.height),a.globalCompositeOperation="screen",a.fillStyle="#505a51",a.fillRect(t,o,e.width,e.height),a.globalCompositeOperation="source-over"}function playCameraFlashAnimation(){$("#cameraflash").animate({opacity:"1"},200,"linear",function(){$("#cameraflash").animate({opacity:"0"},1200,"linear")})}function createFinalBillCanvas(){var e=document.getElementById("finalrodcanvas"),a=document.getElementById("initialbillcanvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var o=new Image;o.onload=function(){t.drawImage(o,0,0),t.shadowColor="rgba(0, 0, 0, 0.4)",t.shadowBlur=8,t.shadowOffsetX=4,t.shadowOffsetY=4,drawRotatedImage(a,t,-46,91,-4.47,945,402),drawRotatedImage(a,t,765,798,-13.01,945,402),drawRotatedImage(a,t,-149,329,-14.61,945,402),drawRotatedImage(a,t,44,812,15.38,945,402),drawRotatedImage(a,t,-430,1094,-66,945,402),drawRotatedImage(a,t,469,1215,-102.3,945,402),drawRotatedImage(a,t,-565,142,18,945,402),drawRotatedImage(a,t,423,400,102.2,945,402),drawRotatedImage(a,t,129,403,-7.53,945,402),t.shadowColor="rgba(0, 0, 0, 0)";var i=new Image;i.onload=function(){t.drawImage(i,0,0);var a=e.toDataURL("image/jpeg",1);$("#billgeneratedimg").attr("src",a),playCameraFlashAnimation(),$("#download-btn").attr("class","rodbutton")},i.src="assets/frame.png"},o.src="assets/bill_background.jpg"}$uploadCrop=window.innerWidth<=768?$("#upload-demo").croppie({viewport:{width:"min(70vw, 380px)",height:"min(70vw, 380px)"},boundary:{width:"min(80vw, 420px)",height:"min(80vw, 420px)"},enforceBoundary:!1,enableExif:!0,enableOrientation:!0}):$("#upload-demo").croppie({viewport:{width:380,height:380},boundary:{width:420,height:420},enforceBoundary:!1,enableExif:!0,enableOrientation:!0}),$("#cropImagePop").on("shown.bs.modal",function(){var e=$(".modal-body").width();console.log(e),$uploadCrop.croppie("bind",{url:rawImg}).then(function(){console.log("jQuery bind complete");var e=new Image;e.src=rawImg,EXIF.getData(e,function(){6==(exifOrientation=EXIF.getTag(this,"Orientation"))&&(croppieOrientation=6)})})}),$(".uploadface-btn").on("change",function(){imageId=$(this).data("id"),tempFilename=$(this).val(),$("#cancelCropBtn").data("id",imageId),readFile(this)}),$("#flipImageBtn").on("click",function(){croppieOrientation=croppieOrientFlipHorizontal(croppieOrientation),$uploadCrop.croppie("bind",{url:rawImg,orientation:croppieOrientation})}),$("#rotateBtn").on("click",function(e){croppieOrientation=croppieOrientRotateRight(croppieOrientation),$uploadCrop.croppie("bind",{url:rawImg,orientation:croppieOrientation})}),$("#cropImageBtn").on("click",function(e){$uploadCrop.croppie("result",{type:"base64",format:"png",backgroundColor:"#FFFFFF",size:{width:402,height:402}}).then(function(e){$("#faceimg").attr("src",e),$("#cropImagePop").modal("hide"),createInitialBillCanvas()})});let isIOS=/iPad|iPhone|iPod/.test(navigator.platform);download_canvas_img=function(e){var a=document.getElementById("finalrodcanvas").toDataURL("image/jpeg");if(isIOS){var t=document.getElementById("download-btn");t.removeAttribute("download"),t.setAttribute("target","_blank")}e.href=a};